# 2. 빅데이터의 탐색

> **※ 본 장(2.1~2.5) 내용은 다음 출처를 바탕으로 정리하였습니다.**  
> **출처: https://jinyshin.notion.site/4-12e4cff72326800a8dfbc8fa89503189 (4회차 스터디 내용 준비)**

---

## 2.1 크로스 집계의 기본

### 트랜잭션 테이블과 크로스 집계

- 데이터베이스의 테이블은 **컬럼 추가가 어렵다**. 컬럼을 하나 추가하면 각 row마다 값을 넣어야 하기 때문이다.
  - 이런 형태의 테이블을 **트랜잭션 테이블**이라고 한다.
- **트랜잭션 테이블**에서 **크로스 테이블**로 바꾸는 과정을 **크로스 집계**라고 한다.
  - **크로스 집계**: 트랜잭션 테이블(DB가 다루기 편한 형태) → 크로스 테이블(사람이 보기 편한 형태)로 변환하는 과정.
  - 소량 데이터를 크로스 집계할 때 편한 도구가 스프레드시트의 **피벗 테이블**이다.

### 데이터 집계 → 데이터 마트 → 시각화

- 데이터를 집계한 뒤 시각화하는 흐름은 다음과 같다.
  1. **데이터 집계**: 데이터 레이크(수십억 레코드)에서 SQL로 대량 집계 → **수만~수억 레코드** 규모의 **데이터 마트** 구축.
  2. **시각화**: 이 데이터 마트를 시각화 도구로 크로스 집계 → **5~100항목** 정도의 대시보드 구축.
- **데이터 마트**는 ‘집계’와 ‘시각화’ 사이에 있다. 데이터 마트 규모에 따라 **트레이드오프**가 생긴다.
- 데이터 양을 **수백만 건** 수준까지 줄일 수 있으면, 전부 시각화 도구에 넣을 수 있어 별도 시스템이 필요 없다.
- 그렇지 않다면 **지연이 적은 데이터베이스**로 데이터 마트를 구성해야 한다.

---

## 2.2 열 지향 스토리지에 의한 고속화

메모리에 전부 올리기 어려운 대량의 데이터를 빠르게 집계하려면, **집계에 맞는 형태로 미리 변환**해 두는 것이 필요하다. 이 절에서는 집계에 유리한 DB 구조를 다룬다.

### DB의 지연을 줄이기

**목표**: 데이터를 **초 단위**로 집계할 수 있게 하기.

- **데이터 처리의 지연**
  - 응답이 빠르다 = **대기 시간(latency)** 이 작다 = 지연이 적다.
  - 데이터 마트를 만들 때는 **지연이 적은 데이터베이스**가 필요하다. 선택지는 크게 두 가지다.
    1. **모든 데이터를 메모리에 올린다.**
    2. **MPP 기술을 활용한다.**

**RDB를 데이터 마트로 쓸 때**

- 예: 한 레코드 500바이트 → 1천만 레코드면 약 5GB. 이 정도면 일반적인 **RDB**로도 데이터 마트 구성이 가능하다.
- RDB는 지연이 적고, 동시 접속이 많아도 성능이 크게 나빠지지 않아 **실제 운영 환경의 데이터 마트**에 잘 맞는다.
- **단점**: 메모리가 부족하면 성능이 급격히 떨어진다. **수억 레코드** 이상에서는 디스크 I/O가 발생한다고 보고, 이를 어떻게 줄일지가 중요하다.

### MPP 기술: 압축과 분산으로 지연 줄이기

- 고속화를 위해 쓰는 방법이 **압축**과 **분산**이다.
- 데이터를 **압축**해 크기를 줄이고, **여러 디스크에 분산**해 두어 로드 시 지연을 줄인다.
- 분산된 데이터를 읽을 때는 **멀티 코어**를 쓰면서 **디스크 I/O를 병렬 처리**하는 것이 효과적이다.
  - 이런 구조를 **MPP(Massively Parallel Processing, 대규모 병렬 처리)** 라고 부른다.
  - 대량 데이터 분석용 DB에서 널리 쓰인다. 예: Amazon Redshift, Google BigQuery.
- MPP는 **집계에 최적화**되어 있으며, 데이터 웨어하우스·분석용 DB에서 특히 많이 사용된다.

---

## 2.3 애드 혹 분석과 시각화 도구

데이터 시각화에 많이 쓰이는 도구를 간단히 정리하면 다음과 같다.

| 도구 유형 | 역할 |
|-----------|------|
| **노트북** | 대화형으로 데이터를 분석할 때 사용 |
| **대시보드 도구** | 정기적으로 그래프를 갱신 |
| **BI 도구** | 대화형 대시보드 제공 |

### 주피터 노트북에 의한 애드 혹 분석

- 데이터 분석은 대부분 **애드 혹 분석**으로 시작한다.
- 원하는 데이터 위치나 집계 시간을 모르는 상태에서 시행착오를 반복하며 데이터를 탐색하는 과정이다.
- 이때 **대화형 실행 환경**이 자주 쓰이며, 그중 **Jupyter Notebook**이 널리 사용된다.

**Jupyter Notebook 특징**

- 분석 과정을 노트처럼 기록해 두며 활용할 수 있다.
- 파이썬, R, 루비 등 스크립트 언어를 실행하는 데 사용된다.
- 보통 로컬호스트에서 기동되는 웹 애플리케이션이다.

**노트북 내 시각화**

- [Matplotlib](https://matplotlib.org/), [Seaborn](https://seaborn.pydata.org/) 등으로 그래프를 그려 셀에 삽입할 수 있다.
- 마우스만으로 대화형 차트를 만들고 싶다면 노트북보다 **스프레드시트·BI 도구** 등 시각화 전용 도구로 넘기는 편이 좋다.

**노트북을 이용한 간이 워크플로우**

- 일련의 태스크를 노트북에 정리해 두고, 메뉴 [Kernel] → [Restart & Run All]으로 모든 셀을 순서대로 실행할 수 있다.
- 가끔 수작업으로만 돌리는 워크플로우라면 이만으로도 충분하다.
- **애드 혹 분석**과 **정기 데이터 처리 자동화**는 필요한 지식과 도구가 다르다. 강한 자동화 동기가 없으면, 노트북 중심의 애드 혹 환경을 먼저 갖추는 것이 우선이다.

### 대시보드 도구

- 애드 혹과 반대로, **정기적으로 쿼리를 실행해 보고서·대시보드를 만드는** 경우에는 BI 도구를 쓰거나, **대시보드 전용 도구**를 쓰는 경우가 많다.
- (참고: 대시보드 도구와 BI 도구의 경계는 엄밀하지 않다.)

#### Redash

- **특징**: 여러 데이터 소스에 연결해 SQL 쿼리 결과를 시각화하는 **오픈소스 대시보드 도구**. 파이썬 기반.
- **사용 방식**: 데이터 소스 등록 → 쿼리 실행 → 표/그래프 생성 → 대시보드에 배치.
- **장점**: 정기 쿼리 결과가 Redash에 저장되어 대시보드가 자동 갱신된다. 별도 데이터 마트 없이 쿼리 결과를 그대로 활용 가능.
- **단점**: 대용량 데이터 처리에는 한계가 있다.

#### Superset

- **특징**: BI 도구와 비슷한 UI의 웹 앱. 마우스 조작으로 **대화형 그래프** 제작 가능.
- **사용 방식**: 여러 데이터 소스 지원, 대화형 시각화로 소스에 빠르게 접근해 집계 결과 확인.
- **저장**: 자체 스토리지가 없어 외부 저장소에 의존. 기본적으로 **Druid**(열 지향 스토리지)를 지원하며 실시간 처리에 적합.
- **단점**: Druid는 테이블 조인을 지원하지 않아, 필요한 데이터를 미리 결합해 두어야 한다.

#### Kibana

- **특징**: **실시간 데이터 시각화**에 많이 쓰이며, **Elasticsearch**의 프론트엔드로 사용된다.
- **사용 방식**: Elasticsearch를 통해 텍스트 검색과 실시간 대시보드 제공.
- **제한**: Elasticsearch만 지원하므로 시각화할 데이터는 반드시 Elasticsearch에 있어야 한다. RDB를 직접 쓰지는 못하지만, 전문 검색·실시간 처리에 유리하다.
- **단점**: SQL 기반의 복잡한 분석에는 부적합하다.

### BI 도구

- **특징**: 장기 데이터 분석, 다양한 조건의 집계, **대화형 대시보드** 작성에 적합하다.
- **데이터 준비**: **데이터 마트**를 만들어 필요한 데이터를 정리·가공한 뒤, 이를 기반으로 다각적 분석·시각화를 한다.
- **장점**: 하나의 데이터를 여러 관점에서 보는 대시보드와 데이터 마트 구성이 쉽고, 다양한 쿼리·조건으로 깊이 있는 분석이 가능하다.

---

## 2.4 데이터 마트의 기본 구조

BI 도구로 대화형 분석을 하려면, **시각화에 필요한 정보만 모은 데이터 마트**가 필요하다. 이 절에서는 데이터 마트 설계의 기본 개념을 정리한다.

### 시각화에 적합한 데이터 마트 — OLAP

BI 도구의 핵심 개념 중 하나가 **OLAP(Online Analytical Processing, 온라인 분석 처리)** 다.  
BI 도구는 OLAP를 몰라도 쓰기 쉽게 만들어져 있지만, **데이터 마트를 설계·구축할 때는** 어느 정도 이해가 필요하다.

#### 다차원 모델과 OLAP 큐브

**OLAP란?**

- 데이터를 **다차원 구조**로 두고, 여러 “차원”으로 나누어 다양한 각도에서 빠르게 집계·분석하는 방식이다.

**OLAP와 RDB의 차이**

- **RDB**: SQL로 2차원 표(table)에 저장하고, 필요할 때마다 집계한다. 기준(예: 날짜, 지역)이 늘어나면 조회·계산이 반복되어 시간이 걸린다.
- **OLAP**: **다차원 모델**을 쓰고, **OLAP 큐브**에 자주 쓰는 조합을 **미리 계산해 두어** 조회 시 바로 결과를 낸다. 즉 “미리 계산된 캐시”에 가깝다.

**OLAP 큐브의 고속화 아이디어**

- 자주 쓰는 데이터 조합을 미리 계산해 두므로, 쿼리할 때마다 매번 새로 계산할 필요가 없다.

**MDX**

- OLAP에서 다차원 데이터를 조회할 때는 SQL 대신 **MDX(Multidimensional Expressions)** 라는 쿼리 언어를 사용한다.

(참고: Apache Hive, Trino 등이 OLAP 성격의 도구이며, Databricks에서는 Medallion Architecture를 권장한다.)

#### MPP DB와 비정규화 테이블

- **MPP(Massively Parallel Processing)** DB와 인메모리 DB가 발달하면서, “미리 다 계산해 두어야만 빠른” OLAP 큐브 의존도가 줄었다.
- MPP DB 성능이 좋아져서, OLAP 큐브 같은 별도 구조 없이 **BI 도구 + MPP DB** 조합으로 실시간 크로스 집계를 하는 경우가 많아졌다.
- BI 도구에서 쉽게 시각화하려면 **시각화 목적에 맞춘 비정규화 테이블**이 필요하다.
- **비정규화 테이블**: 여러 테이블에 흩어진 데이터를 하나의 테이블로 합쳐, 필요한 정보가 한곳에 모여 있는 구조. 이렇게 만든 테이블을 BI 도구에서 열면 OLAP와 비슷한 시각화를 할 수 있다.
- 즉, **“시각화에 적합한 데이터 마트 만들기”** 는 **“BI 도구용 비정규화 테이블 만들기”** 라고 보면 된다.

### 테이블을 비정규화하기

DB 설계에서 테이블을 흔히 **마스터**와 **트랜잭션**으로 나눈다.

- **트랜잭션**: 시간에 따라 쌓이는 사실 데이터(이벤트·거래 등).
- **마스터**: 트랜잭션에서 참조하는 기준 정보(코드, 이름 등). 트랜잭션은 한 번 적히면 잘 안 바뀌고, 마스터는 상황에 따라 갱신된다.

데이터 분석에서는 **정규화된 관계형 모델**에서 출발해, 그와 **반대 방향**인 비정규화 작업을 하게 된다.

#### 팩트 테이블과 디멘전 테이블

- **팩트 테이블(fact table)**: 트랜잭션처럼 “사실”이 기록된 테이블. 판매액·수량 같은 숫자 데이터가 주로 들어간다.
- **디멘전 테이블(dimension table)**: 팩트에서 참조하는 마스터 성격의 데이터. 분류·속성용으로 쓰인다.

#### 스타 스키마와 비정규화

- **스타 스키마(star schema)**: 팩트 테이블을 중심으로 여러 디멘전 테이블이 연결된 구조(별 모양). 데이터 마트 설계에서 자주 쓴다.
- 디멘전은 정규화로 쪼개진 테이블을 **최대한 합쳐** 하나의 테이블로 만든다. 데이터 중복을 허용하는 **비정규화(denormalization)** 이다.

**스타 스키마를 쓰는 이유**

1. 구조가 단순해 이해하기 쉽고, 분석하기 편하다.
2. **성능**: 데이터가 늘어나면 팩트 테이블이 디멘전보다 훨씬 커져, 집계 시간을 좌우한다. 팩트가 메모리를 넘기면 디스크 I/O가 늘어 쿼리가 느려진다. 그래서 **팩트에는 키(ID)만 두고 나머지는 디멘전으로 빼는** 방식이 고속화에 유리하다.

#### 비정규화 테이블과 열 지향 스토리지

- **열 지향 스토리지**: 컬럼 단위로 데이터를 저장해, 컬럼이 많아져도 성능 영향이 상대적으로 작다.
- 이 덕분에 **“하나의 큰 팩트 테이블”** 만 있어도 되는 경우가 많다. 모든 테이블을 결합한 이런 테이블을 **비정규화 테이블**이라 부른다.
- 복잡한 스타 스키마 대신 **단순한 비정규화 테이블**로도 성능과 활용성을 함께 잡을 수 있다.
- 데이터 마트는 **열 지향 스토리지 + 비정규화 테이블** 조합이 일반적이다.

(참고: 데이터 웨어하우스 단계에서는 스타 스키마로 팩트/디멘전을 나누어 적재하고, 분석 단계에서 비정규화 테이블로 합쳐서 쓰는 패턴이 많다.)

### 다차원 모델로 테이블 추상화하기

비정규화 테이블을 준비한 뒤에는 **다차원 모델(multidimensional model)** 로 추상화한다.  
테이블·컬럼을 “분석 관점”으로 정리한 구조로, BI 분석의 기본이 되는 데이터 모델이다.

**구성 요소**

- **디멘전(Dimension)**: 분석의 “기준”이 되는 요소. 예: 날짜, 지역, 제품. 크로스 집계에서 행·열에 쓴다.
- **측정값(Measure)**: 숫자 데이터와 그 집계 방식(합계, 평균 등). 예: 매출액, 판매량.

**예시 (날짜×지역별 매출)**

| 날짜       | 서울       | 부산       | 대구       | 총 매출액     |
|-----------|------------|------------|------------|----------------|
| 2024-10-01 | 1,000,000원 | 800,000원  | 500,000원  | 2,300,000원   |
| 2024-10-02 | 1,200,000원 | 900,000원  | 600,000원  | 2,700,000원   |
| 2024-10-03 | 1,100,000원 | 750,000원  | 550,000원  | 2,400,000원   |
| **총 매출액** | 3,300,000원 | 2,450,000원 | 1,650,000원 | **7,400,000원** |

- 디멘전: 날짜, 지역(서울/부산/대구)  
- 측정값: 매출액  
- 행·열 합계는 날짜별·지역별 집계 결과이다.

---

## 2.5 요약

### 1. 빅데이터 탐색과 시각화

- **피벗 테이블·크로스 집계**: 다양한 기준(디멘전)으로 데이터를 나누어 한눈에 보는 기본 방법.
- **고속 집계**: 초 단위 실시간 분석을 위해선 빠른 집계가 필요하며, **열 지향 스토리지**와 **MPP DB**가 이를 가능하게 한다.

### 2. 시각화 도구의 종류와 목적

| 도구       | 목적 |
|------------|------|
| **노트북** | 애드 혹 분석(필요할 때마다 새로 탐색·분석) |
| **대시보드** | 지속적인 모니터링, 실시간 시각화 |
| **BI 도구** | 대화형 시각화, 한곳에 모은 데이터로 분석. 사용 전 **데이터 마트** 준비가 필요하다. |

### 3. 데이터 마트와 비정규화 테이블

- **데이터 마트**: 팩트 테이블과 디멘전 테이블을 결합해 **비정규화 테이블**을 만든다.
- **저장**: 데이터 양이 적으면 RDB, 많으면 **MPP DB의 열 지향 스토리지**를 쓰는 것이 효율적이다.

### 4. OLAP와 다차원 모델

- 비정규화 테이블을 BI 도구에서 열고, **디멘전(기준)** 과 **측정값(숫자)** 로 나누어 OLAP처럼 분석한다.
- 다차원 모델을 이용해 피벗 테이블처럼 대량 데이터를 여러 관점에서 **크로스 집계**할 수 있다.

---

## 참고

- **본 장(2.1~2.5) 정리 출처: https://jinyshin.notion.site/4-12e4cff72326800a8dfbc8fa89503189** (4회차 스터디 내용 준비)
- Matplotlib: https://matplotlib.org/
- Seaborn: https://seaborn.pydata.org/
