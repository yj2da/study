# 04. 분산 저장 아키텍처 이해

이전 장에서 **HDFS의 구조**(NameNode, DataNode, 복제 등)를 배웠습니다.

이제는 **"HDFS는 왜 이런 방식으로 설계되었을까?"** 를 이해하기 위해, 분산 시스템 설계의 근본적인 원리인 **CAP 정리**를 먼저 살펴봅니다. 그리고 HDFS가 어떤 철학으로 만들어졌는지, 다른 스토리지와 무엇이 다른지 비교해 봅니다.

---

## CAP 정리 (Consistency, Availability, Partition tolerance)

CAP 정리는 **분산 데이터베이스 시스템이 다음 3가지 속성을 동시에 모두 완벽하게 만족할 수 없다**는 이론입니다.

- **Consistency(일관성)**: 모든 노드가 같은 시점에 같은 데이터를 본다.
- **Availability(가용성)**: 요청이 오면 항상 응답을 준다.
- **Partition tolerance(파티션 허용)**: 네트워크가 갈라져도 시스템이 동작한다.

### 핵심: 3가지를 동시에 만족할 수 없다

분산 시스템에서는 **네트워크 분할(partition)을 피할 수 없기 때문에**, Partition tolerance는 필수입니다.  
따라서 **일관성(C)과 가용성(A) 중 하나를 선택**해야 하는 트레이드오프가 생깁니다.

- **CP (일관성 우선)**: 데이터 일관성을 보장하지만, 일부 노드가 응답하지 못할 수 있음 (예: HBase, MongoDB)
- **AP (가용성 우선)**: 항상 응답하지만, 노드마다 다른 데이터를 볼 수 있음 (예: Cassandra, DynamoDB)

**HDFS는?**  
HDFS는 가용성·내결함성을 우선하고, 일부 상황에서의 강한 일관성보다 **고처리량(throughput)** 을 중시합니다.

---

## HDFS의 설계 철학

### Write-once, Read-many

- **한 번 쓰고 여러 번 읽기**에 맞춰 설계되었습니다. 로그·이벤트 데이터처럼 한 번 적재한 뒤 반복 조회·분석하는 워크로드에 적합합니다.
- 파일 **수정·임의 위치 덮어쓰기**는 지원하지 않습니다. 변경이 필요하면 새 파일을 쓰는 방식입니다.

### High throughput vs Low latency

- **처리량(throughput)** 을 우선합니다. 한 번에 많은 데이터를 순차적으로 읽고 쓰는 배치 작업에 유리합니다.
- **낮은 지연(low latency)** 실시간 랜덤 접근이 필요한 워크로드(예: 실시간 DB)에는 적합하지 않습니다.

---

## HDFS vs 다른 분산 스토리지

| 구분            | HDFS                                                   | S3, GCS, Azure Blob                       |
| --------------- | ------------------------------------------------------ | ----------------------------------------- |
| **환경**        | 온프레미스·자체 클러스터                               | 클라우드 관리형 서비스                    |
| **접근**        | HDFS 프로토콜, 로컬처럼 마운트 가능                    | HTTP API, SDK                             |
| **비용**        | 클러스터 구축·운영 비용                                | 사용량 기반 과금                          |
| **적합한 경우** | Hadoop·Spark 등과 같은 클러스터에서 저비용 대용량 저장 | 클라우드 네이티브, 서버리스, 멀티 리전 등 |

- **언제 HDFS를 쓰나**: 이미 Hadoop/Spark 클러스터가 있고, 대용량 배치 데이터를 같은 클러스터 안에서 처리할 때.
- **언제 객체 스토리지를 쓰나**: 클라우드 위주, 다양한 도구와 연동, 비용·운영을 서비스에 맡기고 싶을 때.

### 운영 맥락 (참고)

- 우리 회사는 **IDC를 보유**하고 있어, 외부 클라우드가 아닌 **자체 HDFS 온프레미스**를 사용하고 있습니다.
- **옆 팀에서 구축·운영**하고 있으며, 저는 **사용하는 입장**에서 HDFS에 데이터를 적재하고 조회·분석하는 역할을 합니다.

---

## 핵심 개념 정리

- **CAP**: 일관성·가용성·파티션 허용 중 트레이드오프. HDFS는 가용성·처리량 중심.
- **HDFS**: Write-once, read-many. 고처리량 배치에 적합, 낮은 지연·실시간 수정에는 부적합.
- **HDFS vs S3/GCS**: 온프레미스·Hadoop 생태계 vs 클라우드 관리형 객체 스토리지. 목적에 맞게 선택.

---

## 참고

### 링크·다음 단계

- [HDFS 공식 문서](https://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-hdfs/HdfsDesign.html)
- [05_HDFS_환경구성.md](05_HDFS_환경구성.md) — 실습으로 이어짐.

### 네이버의 HDFS 활용 (참고)

네이버는 대규모 서비스 데이터 처리를 위해 HDFS를 활용하며, NAVER D2 등에서 언급된 바와 같이 **Spark, Hive** 등과 함께 공용 클러스터로 운영하거나, **Cloud Hadoop** 서비스를 통해 완전 관리형 빅데이터 플랫폼으로 제공합니다. 페타바이트 단위 데이터를 저장·처리하는 데 사용됩니다.

- **IDC Seamless HDFS**: 데이터 센터(IDC) 경계를 넘어 데이터를 통합 관리하는 기술. 저장의 물리적 한계를 완화하고 효율을 높임.
- **JuceFS**: HDFS 호환 분산 파일 시스템으로, 오브젝트 스토리지를 활용해 스토리지 효율과 비용 절감을 추구.
- **HBase 연동**: 네이버 검색은 HDFS 기반 HBase(Cuve)로 대규모 데이터를 관리.
- **Cloud Hadoop (네이버 클라우드 플랫폼)**: 완전 관리형 서비스. 사용자가 HDFS 설정 없이 Hadoop, HBase, Spark, Hive 등을 클라우드에서 바로 사용 가능.
- **Heterogeneous Storage**: Pinpoint 등에 이종 스토리지를 적용해 비용 절감 및 속도 개선.

---

## 그림 출처

본 문서에는 인용한 외부 그림이 없습니다.
